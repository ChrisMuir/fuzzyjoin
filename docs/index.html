<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Join Tables Together on Inexact Matching • fuzzyjoin</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">fuzzyjoin</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/stringdist_join.html">Example of `stringdist_inner_join`: Correcting misspellings against a dictionary</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">
<!-- README.md is generated from README.Rmd. Please edit that file -->
<section id="fuzzyjoin-join-data-frames-on-inexact-matching" class="level2"><h2>fuzzyjoin: Join data frames on inexact matching</h2>

<p>The fuzzyjoin package is a variation on dplyr’s <a href="http://www.inside-r.org/node/230646">join</a> operations that allows matching not just on values that match between columns, but on inexact matching. This allows matching on:</p>
<ul>
<li>Numeric values that are within some tolerance (<code>difference_inner_join</code>)</li>
<li>Strings that are similiar in Levenshtein/cosine/Jaccard distance, or <a href="http://finzi.psych.upenn.edu/library/stringdist/html/stringdist-metrics.html">other metrics</a> from the <a href="https://cran.r-project.org/package=stringdist">stringdist</a> package (<code>stringdist_inner_join</code>)</li>
<li>A regular expression in one column matching to another (<code>regex_inner_join</code>)</li>
<li>Euclidean or Manhattan distance across multiple columns (<code>distance_inner_join</code>)</li>
<li>Geographic distance based on longitude and latitude (<code>geo_inner_join</code>)</li>
<li>Intervals of (start, end) that overlap (<code>interval_inner_join</code>)</li>
<li>Genomic intervals, which include both a chromosome ID and (start, end) pairs, that overlap (<code>genome_inner_join</code>)</li>
</ul>
<p>One relevant use case is for classifying freeform text data (such as survey responses) against a finite set of options.</p>
<p>The package also includes:</p>
<ul>
<li>For each of <code>regex_</code>, <code>stringdist_</code>, <code>difference_</code>, <code>distance_</code>, <code>geo_</code>, and <code>interval_</code>, variations for the six dplyr “join” operations- for example,
<ul>
<li>
<code>regex_inner_join</code> (include only rows with matches in each)</li>
<li>
<code>regex_left_join</code> (include all rows of left table)</li>
<li>
<code>regex_right_join</code> (include all rows of right table)</li>
<li>
<code>regex_full_join</code> (include all rows in each table)</li>
<li>
<code>regex_semi_join</code> (filter left table for rows with matches)</li>
<li>
<code>regex_anti_join</code> (filter left table for rows without matches)</li>
</ul>
</li>
<li>A general wrapper (<code>fuzzy_join</code>) that allows you to define your own custom fuzzy matching function.</li>
<li>The option to include the calculated distance as a column in your output, using the <code>distance_col</code> argument</li>
</ul>
<section id="installation" class="level3"><h3>Installation</h3>
<p>Install from CRAN with:</p>
<pre class="sourceCode r" id="cb1"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"fuzzyjoin"</span>)</a></code></pre>
<p>You can also install the development version from GitHub using <a href="https://cran.r-project.org/package=devtools">devtools</a>:</p>
<pre class="sourceCode r" id="cb2"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"dgrtwo/fuzzyjoin"</span>)</a></code></pre>
</section><section id="example-of-stringdist_inner_join-correcting-misspellings-against-a-dictionary" class="level3"><h3>Example of <code>stringdist_inner_join</code>: Correcting misspellings against a dictionary</h3>
<p>Often you find yourself with a set of words that you want to combine with a “dictionary”- it could be a literal dictionary (as in this case) or a domain-specific category system. But you want to allow for small differences in spelling or punctuation.</p>
<p>The fuzzyjoin package comes with a set of common misspellings (<a href="https://en.wikipedia.org/wiki/Wikipedia:Lists_of_common_misspellings/For_machines">from Wikipedia</a>):</p>
<pre class="sourceCode r" id="cb3"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(fuzzyjoin)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">data</span>(misspellings)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">misspellings</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; # A tibble: 4,505 x 2</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;    misspelling    correct</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;          &lt;chr&gt;      &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  1  abandonned  abandoned</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  2   aberation aberration</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  3    abilties  abilities</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  4      abilty    ability</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  5     abondon    abandon</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;  6      abbout      about</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;  7       abotu      about</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt;  8      abouta    about a</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt;  9     aboutit   about it</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 10    aboutthe  about the</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; # ... with 4,495 more rows</span></a></code></pre>
<pre class="sourceCode r" id="cb4"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># use the dictionary of words from the qdapDictionaries package,</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># which is based on the Nettalk corpus.</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">library</span>(qdapDictionaries)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">words &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tbl_df.html">tbl_df</a></span>(DICTIONARY)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">words</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; # A tibble: 20,137 x 2</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;     word syllables</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  * &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  1    hm         1</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  2   hmm         1</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  3  hmmm         1</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  4  hmph         1</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  5 mmhmm         2</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;  6  mmhm         2</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  7    mm         1</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt;  8   mmm         1</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt;  9  mmmm         1</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; 10   pff         1</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; # ... with 20,127 more rows</span></a></code></pre>
<p>As an example, we’ll pick 1000 of these words (you could try it on all of them though), and use <code>stringdist_inner_join</code> to join them against our dictionary.</p>
<pre class="sourceCode r" id="cb5"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2016</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">sub_misspellings &lt;-<span class="st"> </span>misspellings <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/sample.html">sample_n</a></span>(<span class="dv">1000</span>)</a></code></pre>
<pre class="sourceCode r" id="cb6"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">joined &lt;-<span class="st"> </span>sub_misspellings <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/stringdist_join.html">stringdist_inner_join</a></span>(words, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">misspelling =</span> <span class="st">"word"</span>), <span class="dt">max_dist =</span> <span class="dv">1</span>)</a></code></pre>
<p>By default, <code>stringdist_inner_join</code> uses optimal string alignment (Damerau–Levenshtein distance), and we’re setting a maximum distance of 1 for a join. Notice that they’ve been joined in cases where <code>misspelling</code> is close to (but not equal to) <code>word</code>:</p>
<pre class="sourceCode r" id="cb7"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">joined</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; # A tibble: 728 x 4</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;    misspelling correct    word syllables</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;          &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  1       sould  should   could         1</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  2       sould  should  should         1</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  3       sould  should    sold         1</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  4       sould  should    soul         1</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  5       sould  should   sound         1</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  6       sould  should   would         1</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  7       fiels   feels   field         1</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  8       fiels   feels    fils         1</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  9    conscent consent consent         2</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; 10       fleed   freed   bleed         1</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; # ... with 718 more rows</span></a></code></pre>
<section id="classification-accuracy" class="level4"><h4>Classification accuracy</h4>
<p>Note that there are some redundancies; words that could be multiple items in the dictionary. These end up with one row per “guess” in the output. How many words did we classify?</p>
<pre class="sourceCode r" id="cb8"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">joined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">count</a></span>(misspelling, correct)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; # A tibble: 455 x 3</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;    misspelling      correct     n</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;          &lt;chr&gt;        &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;  1   abritrary    arbitrary     1</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;  2   accademic     academic     1</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;  3   accension    ascension     2</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;  4  accessable   accessible     1</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  5    accidant     accident     1</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  6 accidentaly accidentally     1</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  7   accordeon    accordion     1</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  8      addopt        adopt     1</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  9   addtional   additional     1</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 10  admendment    amendment     1</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; # ... with 445 more rows</span></a></code></pre>
<p>So we found a match in the dictionary for about half of the misspellings. In how many of the ones we classified did we get at least one of our guesses right?</p>
<pre class="sourceCode r" id="cb9"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">which_correct &lt;-<span class="st"> </span>joined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(misspelling, correct) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">guesses =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>(), <span class="dt">one_correct =</span> <span class="kw">any</span>(correct <span class="op">==</span><span class="st"> </span>word))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">which_correct</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; # A tibble: 455 x 4</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; # Groups:   misspelling [?]</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;    misspelling      correct guesses one_correct</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;          &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt;       &lt;lgl&gt;</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;  1   abritrary    arbitrary       1        TRUE</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  2   accademic     academic       1        TRUE</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;  3   accension    ascension       2        TRUE</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  4  accessable   accessible       1        TRUE</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;  5    accidant     accident       1        TRUE</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;  6 accidentaly accidentally       1       FALSE</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;  7   accordeon    accordion       1        TRUE</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;  8      addopt        adopt       1        TRUE</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt;  9   addtional   additional       1        TRUE</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt; 10  admendment    amendment       1        TRUE</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; # ... with 445 more rows</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co"># percentage of guesses getting at least one right</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="kw">mean</span>(which_correct<span class="op">$</span>one_correct)</a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt; [1] 0.8527473</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co"># number uniquely correct (out of the original 1000)</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="kw">sum</span>(which_correct<span class="op">$</span>guesses <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>which_correct<span class="op">$</span>one_correct)</a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt; [1] 294</span></a></code></pre>
<p>Not bad.</p>
</section><section id="reporting-distance-in-the-joined-output" class="level4"><h4>Reporting distance in the joined output</h4>
<p>If you wanted to include the distance as a column in your output, you can use the <code>distance_col</code> argument. For example, we may be interested in how many words were <em>two</em> letters apart.</p>
<pre class="sourceCode r" id="cb10"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">joined_dists &lt;-<span class="st"> </span>sub_misspellings <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/stringdist_join.html">stringdist_inner_join</a></span>(words, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">misspelling =</span> <span class="st">"word"</span>), <span class="dt">max_dist =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                        <span class="dt">distance_col =</span> <span class="st">"distance"</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">joined_dists</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; # A tibble: 7,427 x 5</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;    misspelling    correct       word syllables distance</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;          &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  1  charactors characters  character         3        2</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  2  charactors characters charactery         4        2</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  3       sould     should       auld         1        2</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;  4       sould     should       bold         1        2</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;  5       sould     should      bound         1        2</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;  6       sould     should       cold         1        2</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  7       sould     should      could         1        1</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;  8       sould     should       fold         1        2</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;  9       sould     should       foul         1        2</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; 10       sould     should      found         1        2</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; # ... with 7,417 more rows</span></a></code></pre>
<p>Note the extra <code>distance</code> column, which in this case will always be less than or equal to 2. We could then pick the closest match for each, and examine how many of our closest matches were 1 or 2 away:</p>
<pre class="sourceCode r" id="cb11"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">closest &lt;-<span class="st"> </span>joined_dists <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(misspelling) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="dv">1</span>, <span class="kw"><a href="http://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(distance)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">closest</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; # A tibble: 1,437 x 5</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;     misspelling      correct        word syllables distance</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;           &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;  1   charactors   characters   character         3        2</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;  2   charactors   characters  charactery         4        2</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;  3        sould       should       could         1        1</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;  4        sould       should      should         1        1</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt;  5        sould       should        sold         1        1</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;  6        sould       should        soul         1        1</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt;  7        sould       should       sound         1        1</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;  8        sould       should       would         1        1</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;  9 incorportaed incorporated incorporate         4        2</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; 10         awya         away          aa         2        2</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; # ... with 1,427 more rows</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">closest <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">count</a></span>(distance)</a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt;   distance     n</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt;      &lt;dbl&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; 1        0     1</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt; 2        1   725</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; 3        2   711</span></a></code></pre>
</section><section id="other-joining-functions" class="level4"><h4>Other joining functions</h4>
<p>Note that <code>stringdist_inner_join</code> is not the only function we can use. If we’re interested in including the words that we <em>couldn’t</em> classify, we could have use <code>stringdist_left_join</code>:</p>
<pre class="sourceCode r" id="cb12"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">left_joined &lt;-<span class="st"> </span>sub_misspellings <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/stringdist_join.html">stringdist_left_join</a></span>(words, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">misspelling =</span> <span class="st">"word"</span>), <span class="dt">max_dist =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">left_joined</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; # A tibble: 1,273 x 4</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;     misspelling      correct   word syllables</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt;           &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;  1   charactors   characters   &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;  2   Brasillian    Brazilian   &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt;  3        sould       should  could         1</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;  4        sould       should should         1</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;  5        sould       should   sold         1</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  6        sould       should   soul         1</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  7        sould       should  sound         1</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;  8        sould       should  would         1</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt;  9  belligerant  belligerent   &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; 10 incorportaed incorporated   &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; # ... with 1,263 more rows</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"></a>
<a class="sourceLine" id="cb12-20" data-line-number="20">left_joined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">is.na</span>(word))</a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt; # A tibble: 545 x 4</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt;     misspelling      correct  word syllables</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#&gt;           &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co">#&gt;  1   charactors   characters  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt;  2   Brasillian    Brazilian  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="co">#&gt;  3  belligerant  belligerent  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="co">#&gt;  4 incorportaed incorporated  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29"><span class="co">#&gt;  5         awya         away  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">#&gt;  6     occuring    occurring  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="co">#&gt;  7  surveilence surveillance  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32"><span class="co">#&gt;  8    abondoned    abandoned  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">#&gt;  9     alledges      alleges  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="co">#&gt; 10  deliberatly deliberately  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35"><span class="co">#&gt; # ... with 535 more rows</span></a></code></pre>
<p>(To get <em>just</em> the ones without matches immediately, we could have used <code>stringdist_anti_join</code>). If we increase our distance threshold, we’ll increase the fraction with a correct guess, but also get more false positive guesses:</p>
<pre class="sourceCode r" id="cb13"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">left_joined2 &lt;-<span class="st"> </span>sub_misspellings <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/stringdist_join.html">stringdist_left_join</a></span>(words, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">misspelling =</span> <span class="st">"word"</span>), <span class="dt">max_dist =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">left_joined2</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; # A tibble: 7,691 x 4</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt;    misspelling    correct       word syllables</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt;          &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt;  1  charactors characters  character         3</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt;  2  charactors characters charactery         4</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt;  3  Brasillian  Brazilian       &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt;  4       sould     should       auld         1</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt;  5       sould     should       bold         1</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt;  6       sould     should      bound         1</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt;  7       sould     should       cold         1</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt;  8       sould     should      could         1</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt;  9       sould     should       fold         1</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; 10       sould     should       foul         1</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; # ... with 7,681 more rows</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"></a>
<a class="sourceLine" id="cb13-20" data-line-number="20">left_joined2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">is.na</span>(word))</a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; # A tibble: 264 x 4</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt;      misspelling       correct  word syllables</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt;            &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt;  1    Brasillian     Brazilian  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt;  2   belligerant   belligerent  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt;  3      occuring     occurring  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt;  4     abondoned     abandoned  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt;  5  correponding corresponding  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt;  6 archeaologist archaeologist  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co">#&gt;  7   emmediately   immediately  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co">#&gt;  8    possessess     possesses  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">#&gt;  9       unahppy       unhappy  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="co">#&gt; 10        Guilio        Giulio  &lt;NA&gt;        NA</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"><span class="co">#&gt; # ... with 254 more rows</span></a></code></pre>
<p>Most of the missing words here simply aren’t in our dictionary.</p>
<p>You can try other distance thresholds, other dictionaries, and other distance metrics (see [stringdist-metrics] for more). This function is especially useful on a domain-specific dataset, such as free-form survey input that is likely to be close to one of a handful of responses.</p>
</section></section><section id="example-of-regex_inner_join-classifying-text-based-on-regular-expressions" class="level3"><h3>Example of <code>regex_inner_join</code>: Classifying text based on regular expressions</h3>
<p>Consider the book Pride and Prejudice, by Jane Austen, which we can access through the <a href="https://cran.r-project.org/package=janeaustenr">janeaustenr package</a>.</p>
<p>We could split the books up into “passages” of 50 lines each.</p>
<pre class="sourceCode r" id="cb14"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">library</span>(janeaustenr)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">passages &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">data_frame</a></span>(<span class="dt">text =</span> prideprejudice) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="dt">passage =</span> <span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="op">%/%</span><span class="st"> </span><span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">text =</span> <span class="kw">paste</span>(text, <span class="dt">collapse =</span> <span class="st">" "</span>))</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">passages</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; # A tibble: 261 x 2</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt;    passage</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt;  1       1</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt;  2       2</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt;  3       3</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt;  4       4</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt;  5       5</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt;  6       6</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt;  7       7</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt;  8       8</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt;  9       9</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt; 10      10</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt; # ... with 251 more rows, and 1 more variables: text &lt;chr&gt;</span></a></code></pre>
<p>Suppose we wanted to divide the passages based on which character’s name is mentioned in each. Character’s names may differ in how they are presented, so we construct a regular expression for each and pair it with that character’s name.</p>
<pre class="sourceCode r" id="cb15"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">characters &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">"character,character_regex</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">Elizabeth,Elizabeth</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">Darcy,Darcy</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">Mr. Bennet,Mr. Bennet</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">Mrs. Bennet,Mrs. Bennet</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="st">Jane,Jane</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="st">Mary,Mary</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">Lydia,Lydia</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="st">Kitty,Kitty</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="st">Wickham,Wickham</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="st">Mr. Collins,Collins</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="st">Lady Catherine de Bourgh,de Bourgh</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="st">Mr. Gardiner,Mr. Gardiner</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="st">Mrs. Gardiner,Mrs. Gardiner</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="st">Charlotte Lucas,(Charlotte|Lucas)</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="st">"</span>)</a></code></pre>
<p>Notice that for each character, we’ve defined a regular expression (sometimes allowing ambiguity, sometimes not) for detecting their name. Suppose we want to “classify” passages based on whether this regex is present.</p>
<p>With fuzzyjoin’s <code>regex_inner_join</code> function, we do:</p>
<pre class="sourceCode r" id="cb16"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">character_passages &lt;-<span class="st"> </span>passages <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/regex_join.html">regex_inner_join</a></span>(characters, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">text =</span> <span class="st">"character_regex"</span>))</a></code></pre>
<p>This combines the two data frames based on cases where the <code>passages$text</code> column is matched by the <code>characters$character_regex</code> column. (Note that the dataset with the text column must always come first). This results in:</p>
<pre class="sourceCode r" id="cb17"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">character_passages <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(passage, character, text)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; # A tibble: 1,126 x 3</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt;    passage       character</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt;      &lt;dbl&gt;           &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt;  1       1      Mr. Bennet</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt;  2       1            Jane</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt;  3       2      Mr. Bennet</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;  4       2            Jane</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;  5       2           Lydia</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;  6       2 Charlotte Lucas</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;  7       3       Elizabeth</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt;  8       3      Mr. Bennet</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt;  9       3     Mrs. Bennet</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; 10       4      Mr. Bennet</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt; # ... with 1,116 more rows, and 1 more variables: text &lt;chr&gt;</span></a></code></pre>
<p>This shows that Mr. Bennet’s name appears in passages 1, 2, 4, and 6, while Charlotte Lucas’s appears in 3. Notice that having fuzzy-joined the datasets, some passages will end up duplicated (those with multiple names in them), while it’s possible others will be missing entirely (those without names).</p>
<p>We could ask which characters are mentioned in the most passages:</p>
<pre class="sourceCode r" id="cb18"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">character_passages <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">count</a></span>(character, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; # A tibble: 14 x 2</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt;                   character     n</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt;                       &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt;  1                Elizabeth   227</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt;  2                    Darcy   159</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt;  3                     Jane   134</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt;  4              Mrs. Bennet    89</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt;  5                  Wickham    89</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt;  6                    Lydia    79</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt;  7              Mr. Collins    75</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt;  8          Charlotte Lucas    68</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt;  9               Mr. Bennet    55</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; 10                    Kitty    42</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; 11            Mrs. Gardiner    35</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt; 12 Lady Catherine de Bourgh    25</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt; 13             Mr. Gardiner    25</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt; 14                     Mary    24</span></a></code></pre>
<p>The data is also well suited to discover which characters appear in scenes together, and to cluster them to find groupings of characters (like in [this analysis]).</p>
<pre class="sourceCode r" id="cb19"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">passage_character_matrix &lt;-<span class="st"> </span>character_passages <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(passage) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="st">  </span>reshape2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/reshape2/topics/cast">acast</a></span>(character <span class="op">~</span><span class="st"> </span>passage, <span class="dt">fun.aggregate =</span> length, <span class="dt">fill =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">passage_character_matrix &lt;-<span class="st"> </span>passage_character_matrix <span class="op">/</span><span class="st"> </span><span class="kw">rowSums</span>(passage_character_matrix)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">h &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(passage_character_matrix, <span class="dt">method =</span> <span class="st">"manhattan"</span>))</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="kw">plot</span>(h)</a></code></pre>
<p><img src="README-fig/character_passages_matrix-1.png" width="576"></p>
<p>Other options for further analysis of this fuzzy-joined dataset include doing sentiment analysis on text surrounding each character’s name, <a href="http://juliasilge.com/blog/You-Must-Allow-Me/">similar to Julia Silge’s analysis here</a>.</p>
</section><section id="future-work" class="level3"><h3>Future Work</h3>
<p>A few things I’d like to work on:</p>
<ul>
<li><p><strong>Shortcuts on string distance matching</strong>: If two strings are more than 1 character apart in length, the method is <code>osa</code>, and <code>max_dist</code> is 1, you don’t even need to compare them.</p></li>
<li><p><strong>More examples</strong>: I’ve used this package in other powerful ways, but on proprietary data. I’m interested in ideas for use cases that can be provided as vignettes.</p></li>
</ul></section><section id="code-of-conduct" class="level3"><h3>Code of Conduct</h3>
<p>Please note that this project is released with a <a href="CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</section></section>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2 class="hasAnchor">
<a href="#sidebar" class="anchor"></a>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cran.r-project.org/package=fuzzyjoin">https://​cran.r-project.org/​package=fuzzyjoin</a>
</li>
</ul>
<h2>License</h2>
<p><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE.html">LICENSE</a></p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>David Robinson <br><small class="roles"> Author, maintainer </small> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=fuzzyjoin"><img src="https://www.r-pkg.org/badges/version/fuzzyjoin" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://travis-ci.org/dgrtwo/fuzzyjoin"><img src="https://travis-ci.org/dgrtwo/fuzzyjoin.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/dgrtwo/fuzzyjoin"><img src="https://ci.appveyor.com/api/projects/status/github/dgrtwo/fuzzyjoin?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://codecov.io/github/dgrtwo/fuzzyjoin?branch=master"><img src="https://img.shields.io/codecov/c/github/dgrtwo/fuzzyjoin/master.svg" alt="Coverage Status"></a></li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by David Robinson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
